#!/bin/bash
# Pre-commit hook to remind developers about screenshot regeneration
#
# Installation:
#   cp hooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit

set -e

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Check if UI files were modified
UI_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E "app/templates/|app/static/css/|app/static/js/" || true)

if [ -n "$UI_FILES" ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  UI files were modified:${NC}"
    echo "$UI_FILES" | sed 's/^/   /'
    echo ""
    echo -e "${YELLOW}üì∏ Consider regenerating screenshots:${NC}"
    echo "   nox -s screenshots"
    echo ""
    echo -e "${YELLOW}‚ùì Did you update screenshots? (y/n/skip)${NC}"

    # Read user input
    read -r response

    case "$response" in
        y|Y|yes|YES)
            echo -e "${GREEN}‚úÖ Great! Continuing with commit...${NC}"
            ;;
        skip|SKIP|s|S)
            echo -e "${YELLOW}‚è≠Ô∏è  Skipping screenshot check...${NC}"
            ;;
        *)
            echo -e "${RED}‚ùå Please regenerate screenshots before committing:${NC}"
            echo "   nox -s screenshots"
            echo ""
            echo "Then stage the updated screenshots:"
            echo "   git add docs/images/screenshots/"
            echo ""
            echo "Or run this hook with 'skip' to bypass this check."
            exit 1
            ;;
    esac
fi

# Check if screenshot test files were modified
SCREENSHOT_TESTS=$(git diff --cached --name-only --diff-filter=ACM | grep -E "tests/e2e/test_screenshot_generation.py|tests/e2e/fixtures/screenshot_data.py" || true)

if [ -n "$SCREENSHOT_TESTS" ]; then
    echo -e "${YELLOW}üìù Screenshot test files modified${NC}"
    echo -e "${YELLOW}üí° Tip: Run screenshot tests to verify changes:${NC}"
    echo "   nox -s screenshots"
    echo ""
fi

exit 0
